({647:function(){var t=this&&this.__assign||function(){return t=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)},e=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(i,l){function s(t){try{o(a.next(t))}catch(t){l(t)}}function r(t){try{o(a.throw(t))}catch(t){l(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,r)}o((a=a.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var n,a,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=r(0),s.throw=r(1),s.return=r(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(l=0)),l;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!((i=(i=l.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){l=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){l.label=r[1];break}if(6===r[0]&&l.label<i[1]){l.label=i[1],i=r;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(r);break}i[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(t){r=[6,t],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}};!function(){try{return JSON.parse(localStorage.getItem("dnd.character.editor.layout.v1")||"")}catch{return null}}();var a={Acrobatics:"DEX","Animal Handling":"WIS",Arcana:"INT",Athletics:"STR",Deception:"CHA",History:"INT",Insight:"WIS",Intimidation:"CHA",Investigation:"INT",Medicine:"WIS",Nature:"INT",Perception:"WIS",Performance:"CHA",Persuasion:"CHA",Religion:"INT","Sleight of Hand":"DEX",Stealth:"DEX",Survival:"WIS"},i=["STR","DEX","CON","INT","WIS","CHA"],l=Object.keys(a);function s(){var t;try{var e=null!==(t=globalThis.webviewApi)&&void 0!==t?t:window.webviewApi;if(e&&"function"==typeof e.postMessage&&"function"==typeof e.onMessage)return e}catch(t){}return null}function r(){return e(this,arguments,void 0,function(t){var e,a;return void 0===t&&(t=1200),n(this,function(n){switch(n.label){case 0:e=Date.now(),n.label=1;case 1:return(a=s())?[2,a]:Date.now()-e>t?[2,null]:[4,new Promise(function(t){return setTimeout(t,50)})];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return[2]}})})}var o=function(t,e,n){return Math.max(e,Math.min(n,t))},c=function(t,e){void 0===e&&(e=0);var n=parseInt(String(t),10);return Number.isFinite(n)?n:e};function d(t){return Math.floor((t-10)/2)}function p(t){var e,n=i.reduce(function(e,n){return e[n]=d(t.abilities[n]),e},{}),s=(e=t.level||1)>=17?6:e>=13?5:e>=9?4:e>=5?3:2,r=i.reduce(function(e,a){var i,l=n[a],r=(null===(i=t.savingThrowsProficiencies)||void 0===i?void 0:i[a])?s:0;return e[a]=l+r,e},{}),o=l.reduce(function(e,i){var l,r=n[a[i]],o=(null===(l=t.skillsProficiencies)||void 0===l?void 0:l[i])||"none",c="prof"===o?s:"expert"===o?2*s:0;return e[i]=r+c,e},{});const c=t.spellcasting||{},p=c.ability&&i.includes(c.ability)?c.ability:"INT",u=d(t.abilities[p]),v=8+u+s+(c.miscSaveDC||0),g=u+s+(c.miscAttackMod||0);var f=10+o.Perception,m=n.DEX;return{mods:n,proficiencyBonus:s,skills:o,savingThrows:r,passivePerception:f,initiative:m,spellSaveDC:v,spellAtkMod:g,spellAbility:p}}function u(t){if(t=t.trim(),/^\s*([+\-]?\d+)\s*$/.test(t)){var e=parseInt(t,10);return{total:e,detail:"".concat(e)}}var n=/^\s*(?:(-?\d*)\s*)?d\s*(\d+)\s*([+\-]\s*\d+)?\s*$/i.exec(t);if(!n)return{total:NaN,detail:"Invalid roll"};for(var a=n[1],i=n[2],l=n[3],s=a?parseInt(a,10):1,r=parseInt(i,10),o=l?parseInt(l.replace(/\s+/g,""),10):0,c=Math.max(1,Math.abs(s)),d=[],p=0;p<c;p++)d.push(1+Math.floor(Math.random()*r));var u=d.reduce(function(t,e){return t+e},0),v=(u=s<0?-u:u)+o,g=o>=0?"+".concat(o):"".concat(o);return{total:v,detail:"".concat(s,"d").concat(r).concat(o?g:""," = [").concat(d.join(", "),"] ").concat(s<0?"=> negate ":"").concat(u).concat(o?" ".concat(g," = ").concat(v):"")}}function v(t){var e=String(t||"0").replace(/\s+/g,"");e||(e="0");for(var n,a=e.replace(/^\+/,""),i=/^[+\-]/.test(e)?e:"+"+e,l=[],s=/([+\-])(\d*d\d+|\d+)/gi;null!==(n=s.exec(i));)l.push({sign:"-"===n[1]?-1:1,term:n[2]});var r=0,o=[];l.forEach(function(t){var e=t.term.toLowerCase();if(e.includes("d")){var n=/^(\d*)d(\d+)$/.exec(e);if(!n)return;var a=n[1]?parseInt(n[1],10):1,i=parseInt(n[2],10);a=Math.max(1,a);for(var l=[],s=0;s<a;s++)l.push(1+Math.floor(Math.random()*i));var c=l.reduce((t,e)=>t+e,0)*t.sign;r+=c,o.push(`${t.sign<0?"-":"+"}${a}d${i}[${l.join(",")}]${t.sign<0?"(neg)":""}`)}else{var d=parseInt(e,10);Number.isFinite(d)||(d=0),d*=t.sign,r+=d,o.push(`${t.sign<0?"-":"+"}${Math.abs(d)}`)}});var c=o.join(" ").replace(/^\+/,""),d=i,p=null;return/^\+?\d*d\d+(?:[+\-]\d+)?$/i.test(d)&&(p=d.replace(/^\+/,"")),{total:r,detail:c,expr:d,exprForHost:p,raw:a}}function g(){return{name:"",class:"",level:1,race:"",background:"",alignment:"",abilities:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},armorClass:10,maxHP:1,currentHP:1,tempHP:0,speed:"30 ft",savingThrowsProficiencies:{},skillsProficiencies:l.reduce(function(t,e){return t[e]="none",t},{}),attacks:[],spells:[],inventory:[],notes:"",spellcasting:{ability:"NA",miscSaveDC:0,miscAttackMod:0,cantripsKnown:0,preparedSpells:0,slots:{1:{total:0,used:0},2:{total:0,used:0},3:{total:0,used:0},4:{total:0,used:0},5:{total:0,used:0},6:{total:0,used:0},7:{total:0,used:0},8:{total:0,used:0},9:{total:0,used:0}}}}}var f=null;function m(t){return"dnd.character.editor.v1:"+(t||"unknown")}var h=null,b=g(),x=p(b),y=null;function k(t,e){void 0===e&&(e=1600);var n=document.getElementById("status");n&&(n.textContent=t),y&&window.clearTimeout(y),y=window.setTimeout(function(){n&&n.textContent===t&&(n.textContent="")},e)}function C(e){b=t(t({},b),e),x=p(b),M()}function w(t,e){for(var n,a=t.split("."),i=a.pop(),l=b,s=0,r=a;s<r.length;s++){var o=r[s];l[o]=null!==(n=l[o])&&void 0!==n?n:{},l=l[o]}l[i]=e,x=p(b),M()}function E(t,e,n){void 0===e&&(e={}),void 0===n&&(n=[]);for(var a=document.createElement(t),i=0,l=Object.entries(e);i<l.length;i++){var s=l[i],r=s[0],o=s[1];"class"===r?a.className=o:"style"===r&&"object"==typeof o?Object.assign(a.style,o):r.startsWith("data-")?a.setAttribute(r,String(o)):"for"===r?a.setAttribute("for",String(o)):"value"===r?a.value=o:r in a?a[r]=o:a.setAttribute(r,String(o))}for(var c=0,d=n;c<d.length;c++){var p=d[c];a.appendChild("string"==typeof p?document.createTextNode(p):p)}return a}function S(t,e,n,a,i){void 0===i&&(i="text");var l=E("input",{id:e,type:i,value:n,class:"inp"});return l.addEventListener("input",function(){return a(l.value)}),E("label",{class:"lbl"},[E("div",{class:"lblt"},[t]),l])}function I(t,e,n,a,i,l){var s=E("input",{id:e,type:"number",value:n,class:"inp"});return void 0!==i&&s.setAttribute("min",String(i)),void 0!==l&&s.setAttribute("max",String(l)),s.addEventListener("input",function(){return a(c(s.value,n))}),E("label",{class:"lbl"},[E("div",{class:"lblt"},[t]),s])}function L(){var t=document.getElementById("root");if(t){var e=document.createElement("style");e.textContent="\n    :root { --bd:#d0d4db; --tx:#101216; --mut:#5a6270; --bg:#ffffff; --chip:#f5f7fa; }\n    * { box-sizing: border-box; }\n    body { margin:0; background: var(--bg); color: var(--tx); font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }\n    .wrap { padding: 12px; }\n    h2 { margin: 16px 0 8px; font-size: 16px; }\n    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }\n    .grid3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }\n    .cols { display: grid; grid-template-columns: 320px 1fr; gap: 16px; align-items: start; }\n    .card { border: 1px solid var(--bd); border-radius: 10px; padding: 10px; background: #fff; }\n    .lbl { display:block; }\n    .lblt { font-size: 11px; color: var(--mut); margin-bottom: 4px; }\n    .inp, .sel, textarea { width: 100%; padding: 8px; border: 1px solid var(--bd); border-radius: 8px; background: #fff; }\n    textarea { min-height: 80px; resize: vertical; }\n    .row { display:flex; gap:8px; align-items:center; }\n    .mut { color: var(--mut); }\n    .chip { background: var(--chip); border:1px solid var(--bd); padding:6px 8px; border-radius: 8px; }\n    .skills { display: grid; grid-template-columns: 1fr auto auto; gap: 6px 8px; align-items: center; }\n    .skillHead { font-size: 12px; color:var(--mut); display: contents; }\n    .btn { border:1px solid var(--bd); background:#fff; padding:8px 10px; border-radius: 8px; cursor:pointer; }\n    .btn:hover { background:#f9fafb; }\n    .btn.small { padding:4px 6px; font-size:12px; }\n    .right { text-align: right; }\n    .status { margin-left: 8px; color: var(--mut); }\n    .attacks .hdr, .attacks .row {\n        display: grid;\n        grid-template-columns: 1.2fr 100px 100px 1fr 1fr max-content; /* Attack | Range | Hit/DC | Damage | Notes | âœ• */\n        gap: 6px;\n        align-items: center;\n    }\n    .attacks .hdr { color: var(--mut); font-size:12px; }\n    .attack-roll-btn { white-space: nowrap; }\n\n    /* Top bar (left: roll/load/save, right: tabs) */\n    .topbar {\n      position: sticky; top: 0; z-index: 10;\n      display: flex; justify-content: space-between; align-items: center;\n      margin-bottom: 8px; padding-top: 8px; background: var(--bg);\n    }\n    .topbar .leftActions, .topbar .rightActions {\n      display: flex; align-items: center; gap: 8px;\n    }\n    .tab.btn {} /* inherits .btn */\n    .tab.btn.active { box-shadow: 0 1px 4px rgba(0,0,0,0.08); }\n\n    /* Right column container (avoid global .right{text-align:right}) */\n    .rightCol { display: flex; flex-direction: column; min-width: 420px; }\n    .rightPanel { display: flex; flex-direction: column; gap: 16px; }\n\n    /* Keep skill prof selects compact and stable */\n    .skills select, .skills .sel {\n      width: 88px !important; min-width: 88px !important; max-width: 88px !important;\n      flex: 0 0 88px; justify-self: start;\n    }\n    .skills { grid-template-columns: 1fr max-content max-content; }\n\n    /* Saving throws compactness */\n    .saving-throws-grid .row { gap: 6px; }\n    .saving-throws-grid .mut { white-space: nowrap; }\n\n    /* Optional: tighten first card header spacing */\n    .left .card:first-child h2, .rightCol .card:first-child h2 { margin-top: 0; }\n  ",e.textContent+="\n  /* Attacks table: header + rows share the same columns */\n  .attacks .header,\n  .attacks .rowGrid {\n    display: grid;\n    grid-template-columns: 1.2fr 100px 100px 1fr 1fr max-content; /* Attack | Range | Hit/DC | Damage | Notes | âœ• */\n    gap: 6px;\n    align-items: center;\n  }\n  .attacks .header {\n    color: var(--mut);\n    font-size: 12px;\n    margin-bottom: 6px;\n  }\n\n  /* Input+button inline for Hit/DC and Damage cells */\n  .cell-inline { display: flex; align-items: center; gap: 6px; }\n\n  /* Smaller dice buttons */\n  .attack-roll-btn {\n    padding: 2px 6px;\n    font-size: 12px;\n    line-height: 1;\n    border-radius: 6px;\n  }\n",e.textContent+="\n  /* Skills container should NOT be a grid */\n  .skillsTable { display: block; }\n\n  /* Header and each row share the same 3-column grid */\n  .skillsHeader,\n  .skillRow {\n    display: grid;\n    grid-template-columns: 1fr max-content max-content; /* Skill | Total | Prof */\n    gap: 6px 8px;\n    align-items: center;\n  }\n\n  .skillsHeader {\n    color: var(--mut);\n    font-size: 12px;\n    margin-bottom: 6px;\n  }\n\n  .skillRow .right { text-align: right; }\n\n  .skillTotalWrap {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    justify-content: flex-end;\n  }\n\n  /* Keep the small dropdowns compact */\n  .skillsTable select,\n  .skillsTable .sel {\n    width: 88px !important; min-width: 88px !important; max-width: 88px !important;\n    flex: 0 0 88px; justify-self: start;\n  }\n",e.textContent+="\n  /* Spells table mirrors Attacks */\n  .spells .header,\n  .spells .rowGrid {\n    display: grid;\n    grid-template-columns: 1.2fr 100px 100px 1fr 1fr max-content; /* Spell | Range | Hit/DC | Damage | Notes | âœ• */\n    gap: 6px;\n    align-items: center;\n  }\n  .spells .header { color: var(--mut); font-size: 12px; margin-bottom: 6px; }\n\n  /* Inventory table */\n  .inventory .header {\n    display: grid;\n    grid-template-columns: 1.2fr 120px max-content; /* Name | Value | âœ• */\n    gap: 6px;\n    align-items: center;\n  }\n  .inventory .header { color: var(--mut); font-size: 12px; margin-bottom: 6px; }\n  \n  .inventory .itemRow {\n    border: 1px solid var(--bd);\n    border-radius: 8px;\n    padding: 8px;\n    margin-bottom: 8px;\n    background: #fff;\n  }\n  \n  .inventory .itemTopRow {\n    display: grid;\n    grid-template-columns: 1.2fr 120px max-content; /* Name | Value | âœ• */\n    gap: 6px;\n    align-items: center;\n    margin-bottom: 6px;\n  }\n  \n  .inventory .itemDescription {\n    width: 100%;\n    margin-top: 4px;\n  }\n  \n  .inventory .itemDescription textarea {\n    min-height: 60px;\n    resize: vertical;\n  }\n",e.textContent+="\n.spellcasting { display: grid; grid-template-columns: 1fr; gap: 10px; }\n.spellcasting .grid { display: grid; grid-template-columns: 60px 80px 80px 1fr; gap: 6px; align-items: center; }\n.spellcasting .hdr { color: var(--mut); font-size: 12px; }\n.slotDots { display:flex; flex-wrap: wrap; gap: 4px; }\n.dot { width: 16px; height: 16px; border-radius: 50%; border: 1px solid var(--bd); display:inline-flex; align-items:center; justify-content:center; cursor:pointer; font-size:10px; user-select:none; }\n.dot.on  { background:#222; color:#fff; }\n.dot.off { background:#fff; }\n.inline { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }\n",e.textContent+="\n.spellcasting { display: grid; grid-template-columns: 1fr; gap: 10px; }\n.spellcasting .grid { display: grid; grid-template-columns: 60px 80px 80px 1fr; gap: 6px; align-items: center; }\n.spellcasting .hdr { color: var(--mut); font-size: 12px; }\n.slotDots { display:flex; flex-wrap: wrap; gap: 4px; }\n.dot { width: 16px; height: 16px; border-radius: 50%; border: 1px solid var(--bd); display:inline-flex; align-items:center; justify-content:center; cursor:pointer; font-size:10px; user-select:none; }\n.dot.on  { background:#222; color:#fff; }\n.dot.off { background:#fff; }\n.inline { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }\n",document.head.appendChild(e);var n=E("div",{class:"left"}),s=E("div",{class:"rightCol"}),r=E("div",{class:"card"},[E("h2",{},["Identity"]),S("Name","name",b.name,function(t){return C({name:t})}),E("div",{class:"grid2"},[S("Class","class",b.class,function(t){return C({class:t})}),I("Level","level",b.level,function(t){return C({level:o(t,1,20)})},1,20)]),E("div",{class:"grid3"},[S("Race","race",b.race||"",function(t){return C({race:t})}),S("Background","background",b.background||"",function(t){return C({background:t})}),S("Alignment","alignment",b.alignment||"",function(t){return C({alignment:t})})])]),v=E("div",{class:"card"});v.appendChild(E("h2",{},["Abilities"]));var g=E("div",{class:"grid3"});i.forEach(function(t){var e=I(`${t} (mod ${$(x.mods[t])})`,`abil.${t}`,b.abilities[t],function(e){return w(`abilities.${t}`,o(e,1,30))},1,30);e.setAttribute("data-ability",t),g.appendChild(e)}),v.appendChild(g);var f=E("div",{class:"card"});f.appendChild(E("h2",{},["Saving Throws"]));var m=E("div",{class:"grid3 saving-throws-grid"});i.forEach(function(t){var e=E("div",{class:"row chip"},[E("input",{type:"checkbox",checked:!!b.savingThrowsProficiencies[t]}),E("div",{},[`${t} save`]),E("div",{class:"mut"},[E("span",{id:`save.total.${t}`},[$(x.savingThrows[t])])])]);e.firstChild.addEventListener("change",function(e){var n=e.target.checked;w(`savingThrowsProficiencies.${t}`,n)}),m.appendChild(e)}),f.appendChild(m);var y=E("div",{class:"card"},[E("h2",{},["Combat"]),E("div",{class:"grid3"},[I("Armor Class","ac",b.armorClass,function(t){return C({armorClass:o(t,0,40)})},0,40),I("HP (max)","hp.max",b.maxHP,function(t){return C({maxHP:Math.max(1,t)})},1),I("HP (current)","hp.cur",b.currentHP,function(t){return C({currentHP:o(t,0,b.maxHP)})},0)]),E("div",{class:"grid3",style:{marginTop:"6px"}},[S("Speed","speed",b.speed||"",function(t){return C({speed:t})}),I("Temp HP","hp.temp",b.tempHP||0,function(t){return C({tempHP:Math.max(0,t)})},0),E("label",{class:"lbl"},[E("div",{class:"lblt"},["Initiative"]),E("div",{class:"chip"},[E("span",{id:"derived.initiative"},[$(x.initiative)])," (DEX mod)"])])]),E("div",{class:"row",style:{marginTop:"6px"}},[E("div",{class:"chip"},["Prof bonus: ",E("strong",{id:"derived.pb"},[$(x.proficiencyBonus)])]),E("div",{class:"chip"},["Passive Perception: ",E("strong",{id:"derived.pp"},[String(x.passivePerception)])])])]);n.appendChild(r),n.appendChild(v),n.appendChild(f),n.appendChild(y);var L=E("div",{class:"card"});L.appendChild(E("h2",{},["Skills"]));var N=E("div",{class:"skillsTable"}),P=E("div",{class:"skillsHeader"},[E("div",{},["Skill"]),E("div",{class:"right"},["Total"]),E("div",{},["Prof"])]);N.appendChild(P),l.forEach(function(t){var e=E("div",{},[`${t} `,E("span",{class:"mut"},[`(${a[t]})`])]),n=E("div",{id:`skill.total.${t}`,class:"right"},[$(x.skills[t])]),i=E("button",{class:"btn small",title:"Roll skill"},["ðŸŽ²"]),l=E("div",{class:"skillTotalWrap"},[n,i]);i.addEventListener("click",function(){var e,n=`1d20${e=x.skills[t],e>=0?"+".concat(e):"".concat(e)}`;if(h)h.postMessage({type:"roll",expr:n});else{var a=u(n);k(`Roll ${t}: ${a.total} (${a.detail})`,4e3)}});var s=function(e){var n=E("select",{class:"sel"},[E("option",{value:"none",selected:"none"===e},["â€”"]),E("option",{value:"prof",selected:"prof"===e},["â—"]),E("option",{value:"expert",selected:"expert"===e},["â—Ž"])]);return n.addEventListener("change",function(){return e=n.value,w(`skillsProficiencies.${t}`,e);var e}),n}(b.skillsProficiencies[t]||"none"),r=E("div",{class:"skillRow"},[e,l,s]);N.appendChild(r)}),L.appendChild(N);var R=E("div",{class:"card attacks"});R.appendChild(E("h2",{},["Attacks"]));var j=E("div",{id:"attacks.list"}),B=E("button",{class:"btn",style:{marginTop:"8px"}},["+ Add attack"]);B.addEventListener("click",function(){b.attacks.push({name:"New Attack",range:"Melee",hitDc:"+0",damage:"1d6+2",notes:""}),x=p(b),H()}),R.appendChild(j),R.appendChild(B);var O,z=E("div",{class:"card"},[E("h2",{},["Notes"]),(O=E("textarea",{value:b.notes||""}),O.addEventListener("input",function(){return C({notes:O.value})}),O)]),W=E("div",{class:"card spells"});W.appendChild(E("h2",{},["Spells"]));var F=E("div",{class:"spellcasting card",style:{padding:"10px",border:"1px dashed var(--bd)"}}),X=E("div",{class:"inline"},[function(){const t=E("select",{class:"sel"},i.map(t=>E("option",{value:t,selected:(b.spellcasting?.ability||"INT")===t},[t])));return t.addEventListener("change",()=>w("spellcasting.ability",t.value)),T("Spell Ability",t)}(),I("Cantrips Known","sp.cantrips",b.spellcasting?.cantripsKnown||0,t=>w("spellcasting.cantripsKnown",Math.max(0,t)),0),I("Prepared Spells","sp.prepared",b.spellcasting?.preparedSpells||0,t=>w("spellcasting.preparedSpells",Math.max(0,t)),0),function(){const t=E("input",{class:"inp",type:"number",value:b.spellcasting?.miscSaveDC||0,style:{width:"90px"}});return t.addEventListener("input",()=>w("spellcasting.miscSaveDC",c(t.value,0))),E("div",{class:"lbl"},[E("div",{class:"lblt"},["Spell Save DC"]),E("div",{class:"inline"},[E("span",{class:"chip"},["DC ",E("strong",{id:"derived.spell.dc"},[String(x.spellSaveDC||8+d(b.abilities.INT)+x.proficiencyBonus)])]),E("span",{class:"mut"},["misc"]),t])])}(),function(){const t=E("input",{class:"inp",type:"number",value:b.spellcasting?.miscAttackMod||0,style:{width:"90px"}});return t.addEventListener("input",()=>w("spellcasting.miscAttackMod",c(t.value,0))),E("div",{class:"lbl"},[E("div",{class:"lblt"},["Spell Attack Modifier"]),E("div",{class:"inline"},[E("span",{class:"chip"},[E("strong",{id:"derived.spell.attack"},[$(x.spellAtkMod||0)])]),E("span",{class:"mut"},["misc"]),t])])}()]);F.appendChild(X),F.appendChild(E("div",{class:"grid hdr"},[E("div",{},["Lvl"]),E("div",{},["Total"]),E("div",{},["Used"]),E("div",{},["Slots"])]));for(let t=1;t<=9;t++){const e=`spellcasting.slots.${t}`,n=E("div",{class:"grid"}),a=c(b.spellcasting?.slots?.[t]?.total,0),i=c(b.spellcasting?.slots?.[t]?.used,0),l=E("input",{class:"inp",type:"number",value:a,min:0}),s=E("input",{class:"inp",type:"number",value:i,min:0,max:Math.max(0,a)});l.addEventListener("input",()=>{const t=Math.max(0,c(l.value,0));w(`${e}.total`,t),i>t&&w(`${e}.used`,t),et()}),s.addEventListener("input",()=>{const t=o(c(s.value,0),0,Math.max(0,c(l.value,0)));w(`${e}.used`,t),et()});const r=E("div",{class:"slotDots","data-lvl":String(t)});n.appendChild(E("div",{},[String(t)])),n.appendChild(l),n.appendChild(s),n.appendChild(r),F.appendChild(n)}et(),W.appendChild(F);var K=E("div",{id:"spells.list"}),_=E("button",{class:"btn",style:{marginTop:"8px"}},["+ Add spell"]);_.addEventListener("click",function(){b.spells.push({name:"New Spell",range:"30 ft",hitDc:"+0",damage:"1d6",notes:""}),x=p(b),A()}),W.appendChild(K),W.appendChild(_);var G=E("div",{class:"card inventory"});G.appendChild(E("h2",{},["Inventory"]));var J=E("div",{id:"inventory.list"}),q=E("button",{class:"btn",style:{marginTop:"8px"}},["+ Add item"]);q.addEventListener("click",function(){b.inventory.push({name:"New Item",value:"",desc:""}),D()}),G.appendChild(J),G.appendChild(q),L.setAttribute("data-panel","skills"),R.setAttribute("data-panel","attacks"),z.setAttribute("data-panel","notes"),W.setAttribute("data-panel","spells"),G.setAttribute("data-panel","inventory");var V=E("div",{class:"rightPanel"});V.appendChild(L),V.appendChild(R),V.appendChild(z),V.appendChild(W),V.appendChild(G),s.innerHTML="",s.appendChild(V);var U=E("div",{class:"leftActions"},[E("button",{class:"btn",id:"btn.roll"},["Roll d20"]),E("button",{class:"btn",id:"btn.load"},["Load"]),E("button",{class:"btn",id:"btn.save"},["Save"]),E("div",{id:"status",class:"status"},[""])]),Q=E("div",{class:"rightActions"},[E("button",{class:"btn tab active","data-target":"skills"},["Skills"]),E("button",{class:"btn tab","data-target":"attacks"},["Attacks"]),E("button",{class:"btn tab","data-target":"spells"},["Spells"]),E("button",{class:"btn tab","data-target":"inventory"},["Inventory"]),E("button",{class:"btn tab","data-target":"notes"},["Notes"])]),Y=E("div",{class:"topbar"},[U,Q]);t.innerHTML="";var Z=E("div",{class:"wrap"});Z.appendChild(Y);var tt=E("div",{class:"cols"},[n,s]);Z.appendChild(tt),t.appendChild(Z),Q.addEventListener("click",function(t){var e=t.target.closest(".tab");e&&nt(e.getAttribute("data-target"))}),nt("skills"),document.getElementById("btn.roll").addEventListener("click",function(){if(h)h.postMessage({type:"roll",expr:"1d20"});else{var t=u("1d20");k(`Roll d20: ${t.total} (${t.detail})`,3e3)}}),document.getElementById("btn.save").addEventListener("click",function(){h?h.postMessage({type:"save",character:b}):(function(t){try{localStorage.setItem("dnd.character.editor.v1",JSON.stringify(t))}catch(t){}}(b),k("Saved locally âœ“"))}),document.getElementById("btn.load").addEventListener("click",function(){h?(h.postMessage({type:"load"}),k("Loadingâ€¦")):k("Nothing to load (offline)")}),H(),A(),D(),M()}function et(){for(let t=1;t<=9;t++){const e=F.querySelector(`.slotDots[data-lvl="${t}"]`);if(!e)continue;e.innerHTML="";const n=c(b.spellcasting?.slots?.[t]?.total,0),a=c(b.spellcasting?.slots?.[t]?.used,0);for(let i=0;i<n;i++){const l=i<a,s=E("div",{class:"dot "+(l?"on":"off"),title:l?"Click to unuse":"Click to use"},[l?"â—":"â—‹"]);s.addEventListener("click",()=>{const e=c(b.spellcasting?.slots?.[t]?.used,0);w(`spellcasting.slots.${t}.used`,l?Math.max(0,e-1):Math.min(n,e+1)),et()}),e.appendChild(s)}}}function nt(t){Array.from(Q.querySelectorAll(".tab")).forEach(e=>e.classList.toggle("active",e.getAttribute("data-target")===t)),Array.from(V.children).forEach(e=>e.style.display=e.getAttribute("data-panel")===t?"":"none")}}function A(){var t=document.getElementById("spells.list");t&&(t.innerHTML="",b.spells.forEach(function(e,n){var a=null!=e.hitDc?String(e.hitDc):"+0",i=null!=e.damage?String(e.damage):"1d6",l=null!=e.range?String(e.range):"",s=E("input",{class:"inp",value:e.name||""}),r=E("input",{class:"inp",value:l}),o=E("input",{class:"inp",value:a,title:"Enter modifier (e.g. +5). Double-click/Enter or ðŸŽ² to roll"}),c=E("button",{class:"btn attack-roll-btn",title:"Roll Hit/DC"},["ðŸŽ²"]),d=E("div",{class:"cell-inline"},[o,c]),p=E("input",{class:"inp",value:i,title:"Composite damage like 2d6+1d4+3"}),g=E("button",{class:"btn attack-roll-btn",title:"Roll Damage"},["ðŸŽ²"]),f=E("div",{class:"cell-inline"},[p,g]),m=E("input",{class:"inp",value:e.notes||""}),x=E("button",{class:"btn small",title:"Remove"},["âœ•"]);function y(){var t=parseInt(String(o.value).replace(/\s+/g,""),10);Number.isFinite(t)||(t=0);var n=`1d20${t>=0?"+"+t:t}`;if(h)h.postMessage({type:"roll",expr:n});else{var a=u(n);k(`Spell Hit/DC (${e.name||"Spell"}): ${a.total} (${a.detail})`,4e3)}}function C(){var t=v(String(p.value||"0"));h&&t.exprForHost?h.postMessage({type:"roll",expr:t.exprForHost}):k(`Spell Damage (${e.name||"Spell"}): ${t.total} (${t.detail})`,4e3)}s.addEventListener("input",function(){b.spells[n].name=s.value}),r.addEventListener("input",function(){b.spells[n].range=r.value}),o.addEventListener("input",function(){b.spells[n].hitDc=o.value}),p.addEventListener("input",function(){b.spells[n].damage=p.value}),m.addEventListener("input",function(){b.spells[n].notes=m.value}),x.addEventListener("click",function(){b.spells.splice(n,1),A()}),c.addEventListener("click",y),g.addEventListener("click",C),o.addEventListener("keydown",function(t){"Enter"===t.key&&y()}),o.addEventListener("dblclick",y),p.addEventListener("keydown",function(t){"Enter"===t.key&&C()}),p.addEventListener("dblclick",C);var w=E("div",{class:"rowGrid"},[T("Spell",s),T("Range",r),T("Hit/DC",d),T("Damage",f),T("Notes",m),x]);t.appendChild(w)}))}function D(){var t=document.getElementById("inventory.list");t&&(t.innerHTML="",b.inventory.forEach(function(e,n){var a=E("input",{class:"inp",value:e.name||""}),i=E("input",{class:"inp",value:e.value||"",placeholder:"e.g., 25 gp"}),l=E("textarea",{class:"inp",value:e.desc||"",placeholder:"Item description...",rows:2}),s=E("button",{class:"btn small",title:"Remove"},["âœ•"]);a.addEventListener("input",function(){b.inventory[n].name=a.value}),i.addEventListener("input",function(){b.inventory[n].value=i.value}),l.addEventListener("input",function(){b.inventory[n].desc=l.value}),s.addEventListener("click",function(){b.inventory.splice(n,1),D()});var r=E("div",{class:"itemRow"},[E("div",{class:"itemTopRow"},[T("Item",a),T("Value",i),s]),E("div",{class:"itemDescription"},[T("Description",l)])]);t.appendChild(r)}))}function T(t,e){return E("label",{class:"lbl"},[E("div",{class:"lblt"},[t]),e])}function H(){var t=document.getElementById("attacks.list");t&&(t.innerHTML="",b.attacks.forEach(function(e,n){var a=null!=e.hitDc?String(e.hitDc):null!=e.toHit?String(e.toHit):"+0",i=null!=e.damage?String(e.damage):"1d4",l=null!=e.range?String(e.range):"",s=E("input",{class:"inp",value:e.name||""}),r=E("input",{class:"inp",value:l}),o=E("input",{class:"inp",value:a,title:"Enter modifier (e.g. +5). Double-click/Enter or ðŸŽ² to roll"}),c=E("button",{class:"btn attack-roll-btn",title:"Roll Hit/DC"},["ðŸŽ²"]),d=E("div",{class:"cell-inline"},[o,c]),p=E("input",{class:"inp",value:i,title:"Composite damage like 2d6+1d4+3"}),g=E("button",{class:"btn attack-roll-btn",title:"Roll Damage"},["ðŸŽ²"]),f=E("div",{class:"cell-inline"},[p,g]),m=E("input",{class:"inp",value:e.notes||""}),x=E("button",{class:"btn small",title:"Remove"},["âœ•"]);function y(){var t=parseInt(String(o.value).replace(/\s+/g,""),10);Number.isFinite(t)||(t=0);var n=`1d20${t>=0?"+"+t:t}`;if(h)h.postMessage({type:"roll",expr:n});else{var a=u(n);k(`Hit/DC (${e.name||"Attack"}): ${a.total} (${a.detail})`,4e3)}}function C(){var t=v(String(p.value||"0"));h&&t.exprForHost?h.postMessage({type:"roll",expr:t.exprForHost}):k(`Damage (${e.name||"Attack"}): ${t.total} (${t.detail})`,4e3)}s.addEventListener("input",function(){b.attacks[n].name=s.value}),r.addEventListener("input",function(){b.attacks[n].range=r.value}),o.addEventListener("input",function(){b.attacks[n].hitDc=o.value,b.attacks[n].toHit=o.value}),p.addEventListener("input",function(){b.attacks[n].damage=p.value}),m.addEventListener("input",function(){b.attacks[n].notes=m.value}),x.addEventListener("click",function(){b.attacks.splice(n,1),H()}),c.addEventListener("click",y),g.addEventListener("click",C),o.addEventListener("keydown",function(t){"Enter"===t.key&&y()}),o.addEventListener("dblclick",y),p.addEventListener("keydown",function(t){"Enter"===t.key&&C()}),p.addEventListener("dblclick",C);var w=E("div",{class:"rowGrid"},[T("Attack",s),T("Range",r),T("Hit/DC",d),T("Damage",f),T("Notes",m),x]);t.appendChild(w)}))}function M(){i.forEach(function(t){var e=document.querySelector('[data-ability="'.concat(t,'"] .lblt'));e&&(e.textContent="".concat(t," (mod ").concat($(x.mods[t]),")"))});var t=document.getElementById("derived.pb");t&&(t.textContent=$(x.proficiencyBonus));var e=document.getElementById("derived.pp");e&&(e.textContent=String(x.passivePerception));var n=document.getElementById("derived.initiative");n&&(n.textContent=$(x.initiative)),i.forEach(function(t){var e=document.getElementById("save.total.".concat(t));e&&(e.textContent=$(x.savingThrows[t]))}),l.forEach(function(t){var e=document.getElementById("skill.total.".concat(t));e&&(e.textContent=$(x.skills[t]))});const a=document.getElementById("derived.spell.dc");a&&(a.textContent=String(x.spellSaveDC));const s=document.getElementById("derived.spell.attack");s&&(s.textContent=$(x.spellAtkMod))}function $(t){return t>=0?"+".concat(t):"".concat(t)}function N(t,e){const n={STR:null!==(i=null==(a={...t.abilities,...e.abilities??{}})?void 0:a.STR)&&void 0!==i?i:10,DEX:null!==(s=null==a?void 0:a.DEX)&&void 0!==s?s:10,CON:null!==(r=null==a?void 0:a.CON)&&void 0!==r?r:10,INT:null!==(o=null==a?void 0:a.INT)&&void 0!==o?o:10,WIS:null!==(c=null==a?void 0:a.WIS)&&void 0!==c?c:10,CHA:null!==(d=null==a?void 0:a.CHA)&&void 0!==d?d:10};var a,i,s,r,o,c,d;const p=function(t){for(var e,n={},a=0,i=l;a<i.length;a++){var s=i[a];n[s]=null!==(e=null==t?void 0:t[s])&&void 0!==e?e:"none"}return n}({...t.skillsProficiencies??{},...e.skillsProficiencies??{}});return{...t,...e,abilities:n,savingThrowsProficiencies:{...t.savingThrowsProficiencies||{},...e.savingThrowsProficiencies||{}},skillsProficiencies:p,attacks:(e.attacks||t.attacks||[]).map(t=>({name:"",toHit:"",damage:"",notes:"",...t})),spells:(e.spells||t.spells||[]).map(t=>({name:"New Spell",range:"",hitDc:"+0",damage:"1d6",notes:"",...t})),inventory:(e.inventory||t.inventory||[]).map(t=>({name:"New Item",value:"",desc:"",...t})),spellcasting:{...t.spellcasting,...e.spellcasting||{},slots:{...t.spellcasting.slots,...e.spellcasting&&e.spellcasting.slots||{}}}}}!function(){function t(){try{!function(){e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return document.getElementById("root")||((t=document.createElement("div")).id="root",document.body.appendChild(t)),L(),[4,r(1500)];case 1:if(h=e.sent())h.onMessage(function(t){const e=t&&"object"==typeof t?"message"in t&&"object"==typeof t.message?t.message:"data"in t&&"object"==typeof t.data?t.data:t:t;console.log("[webview] message (unwrapped):",e," raw:",t),e&&"object"==typeof e&&("data"===e.type?(f=e.noteId||f,b=N(g(),e.character||{}),x=p(b),f&&function(t,e){if(t)try{localStorage.setItem(m(t),JSON.stringify(e))}catch{}}(f,b),L(),k("Loaded âœ“")):"saved"===e.type?k("Saved âœ“"):"error"===e.type?k(`Error: ${e.message}`,4e3):"rollResult"===e.type&&k(`Roll: ${e.result}`,4e3))}),h.postMessage({type:"load"});else{const t=f?function(t){if(!t)return null;try{const e=localStorage.getItem(m(t));return e?JSON.parse(e):null}catch{return null}}(f):null;t?(b=N(g(),t),x=p(b),L(),k("Loaded (local cache)")):k("Offline mode â€” using defaults")}return[2]}})})}();const t=s();t&&(h=t).postMessage({type:"ready"})}catch(t){console.error("[renderer] bootstrap error:",t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}()}})[647](),exports.default={}.default;