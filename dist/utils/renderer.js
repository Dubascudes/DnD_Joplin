({647:function(){var t=this&&this.__assign||function(){return t=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)},e=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(i,l){function r(t){try{o(a.next(t))}catch(t){l(t)}}function s(t){try{o(a.throw(t))}catch(t){l(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}o((a=a.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var n,a,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(l=0)),l;)try{if(n=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,a=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(!((i=(i=l.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){l=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){l.label=s[1];break}if(6===s[0]&&l.label<i[1]){l.label=i[1],i=s;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(s);break}i[2]&&l.ops.pop(),l.trys.pop();continue}s=e.call(t,l)}catch(t){s=[6,t],a=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},a={Acrobatics:"DEX","Animal Handling":"WIS",Arcana:"INT",Athletics:"STR",Deception:"CHA",History:"INT",Insight:"WIS",Intimidation:"CHA",Investigation:"INT",Medicine:"WIS",Nature:"INT",Perception:"WIS",Performance:"CHA",Persuasion:"CHA",Religion:"INT","Sleight of Hand":"DEX",Stealth:"DEX",Survival:"WIS"},i=["STR","DEX","CON","INT","WIS","CHA"],l=Object.keys(a);function r(){var t;try{var e=null!==(t=globalThis.webviewApi)&&void 0!==t?t:window.webviewApi;if(e&&"function"==typeof e.postMessage&&"function"==typeof e.onMessage)return e}catch(t){}return null}function s(){return e(this,arguments,void 0,function(t){var e,a;return void 0===t&&(t=1200),n(this,function(n){switch(n.label){case 0:e=Date.now(),n.label=1;case 1:return(a=r())?[2,a]:Date.now()-e>t?[2,null]:[4,new Promise(function(t){return setTimeout(t,50)})];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return[2]}})})}var o=function(t,e,n){return Math.max(e,Math.min(n,t))};function c(t){var e,n=i.reduce(function(e,n){return e[n]=(a=t.abilities[n],Math.floor((a-10)/2)),e;var a},{}),r=(e=t.level||1)>=17?6:e>=13?5:e>=9?4:e>=5?3:2,s=i.reduce(function(e,a){var i,l=n[a],s=(null===(i=t.savingThrowsProficiencies)||void 0===i?void 0:i[a])?r:0;return e[a]=l+s,e},{}),o=l.reduce(function(e,i){var l,s=n[a[i]],o=(null===(l=t.skillsProficiencies)||void 0===l?void 0:l[i])||"none",c="prof"===o?r:"expert"===o?2*r:0;return e[i]=s+c,e},{}),c=10+o.Perception,d=n.DEX;return{mods:n,proficiencyBonus:r,skills:o,savingThrows:s,passivePerception:c,initiative:d}}function d(t){if(t=t.trim(),/^\s*([+\-]?\d+)\s*$/.test(t)){var e=parseInt(t,10);return{total:e,detail:"".concat(e)}}var n=/^\s*(?:(-?\d*)\s*)?d\s*(\d+)\s*([+\-]\s*\d+)?\s*$/i.exec(t);if(!n)return{total:NaN,detail:"Invalid roll"};for(var a=n[1],i=n[2],l=n[3],r=a?parseInt(a,10):1,s=parseInt(i,10),o=l?parseInt(l.replace(/\s+/g,""),10):0,c=Math.max(1,Math.abs(r)),d=[],p=0;p<c;p++)d.push(1+Math.floor(Math.random()*s));var u=d.reduce(function(t,e){return t+e},0),v=(u=r<0?-u:u)+o,f=o>=0?"+".concat(o):"".concat(o);return{total:v,detail:"".concat(r,"d").concat(s).concat(o?f:""," = [").concat(d.join(", "),"] ").concat(r<0?"=> negate ":"").concat(u).concat(o?" ".concat(f," = ").concat(v):"")}}function p(t){var e=String(t||"0").replace(/\s+/g,"");e||(e="0");for(var n,a=e.replace(/^\+/,""),i=/^[+\-]/.test(e)?e:"+"+e,l=[],r=/([+\-])(\d*d\d+|\d+)/gi;null!==(n=r.exec(i));)l.push({sign:"-"===n[1]?-1:1,term:n[2]});var s=0,o=[];l.forEach(function(t){var e=t.term.toLowerCase();if(e.includes("d")){var n=/^(\d*)d(\d+)$/.exec(e);if(!n)return;var a=n[1]?parseInt(n[1],10):1,i=parseInt(n[2],10);a=Math.max(1,a);for(var l=[],r=0;r<a;r++)l.push(1+Math.floor(Math.random()*i));var c=l.reduce((t,e)=>t+e,0)*t.sign;s+=c,o.push(`${t.sign<0?"-":"+"}${a}d${i}[${l.join(",")}]${t.sign<0?"(neg)":""}`)}else{var d=parseInt(e,10);Number.isFinite(d)||(d=0),d*=t.sign,s+=d,o.push(`${t.sign<0?"-":"+"}${Math.abs(d)}`)}});var c=o.join(" ").replace(/^\+/,""),d=i,p=null;return/^\+?\d*d\d+(?:[+\-]\d+)?$/i.test(d)&&(p=d.replace(/^\+/,"")),{total:s,detail:c,expr:d,exprForHost:p,raw:a}}function u(){return{name:"",class:"",level:1,race:"",background:"",alignment:"",abilities:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},armorClass:10,maxHP:1,currentHP:1,tempHP:0,speed:"30 ft",savingThrowsProficiencies:{},skillsProficiencies:l.reduce(function(t,e){return t[e]="none",t},{}),attacks:[],spells:[],inventory:[],notes:""}}var v=null;function f(t){return"dnd.character.editor.v1:"+(t||"unknown")}var g=null,m=u(),h=c(m),b=null;function x(t,e){void 0===e&&(e=1600);var n=document.getElementById("status");n&&(n.textContent=t),b&&window.clearTimeout(b),b=window.setTimeout(function(){n&&n.textContent===t&&(n.textContent="")},e)}function y(e){m=t(t({},m),e),h=c(m),A()}function k(t,e){for(var n,a=t.split("."),i=a.pop(),l=m,r=0,s=a;r<s.length;r++){var o=s[r];l[o]=null!==(n=l[o])&&void 0!==n?n:{},l=l[o]}l[i]=e,h=c(m),A()}function w(t,e,n){void 0===e&&(e={}),void 0===n&&(n=[]);for(var a=document.createElement(t),i=0,l=Object.entries(e);i<l.length;i++){var r=l[i],s=r[0],o=r[1];"class"===s?a.className=o:"style"===s&&"object"==typeof o?Object.assign(a.style,o):s.startsWith("data-")?a.setAttribute(s,String(o)):"for"===s?a.setAttribute("for",String(o)):"value"===s?a.value=o:s in a?a[s]=o:a.setAttribute(s,String(o))}for(var c=0,d=n;c<d.length;c++){var p=d[c];a.appendChild("string"==typeof p?document.createTextNode(p):p)}return a}function E(t,e,n,a,i){void 0===i&&(i="text");var l=w("input",{id:e,type:i,value:n,class:"inp"});return l.addEventListener("input",function(){return a(l.value)}),w("label",{class:"lbl"},[w("div",{class:"lblt"},[t]),l])}function C(t,e,n,a,i,l){var r=w("input",{id:e,type:"number",value:n,class:"inp"});return void 0!==i&&r.setAttribute("min",String(i)),void 0!==l&&r.setAttribute("max",String(l)),r.addEventListener("input",function(){return a(function(t,e){void 0===e&&(e=0);var n=parseInt(String(t),10);return Number.isFinite(n)?n:e}(r.value,n))}),w("label",{class:"lbl"},[w("div",{class:"lblt"},[t]),r])}function S(){var t=document.getElementById("root");if(t){var e=document.createElement("style");e.textContent="\n    :root { --bd:#d0d4db; --tx:#101216; --mut:#5a6270; --bg:#ffffff; --chip:#f5f7fa; }\n    * { box-sizing: border-box; }\n    body { margin:0; background: var(--bg); color: var(--tx); font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }\n    .wrap { padding: 12px; }\n    h2 { margin: 16px 0 8px; font-size: 16px; }\n    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }\n    .grid3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }\n    .cols { display: grid; grid-template-columns: 320px 1fr; gap: 16px; align-items: start; }\n    .card { border: 1px solid var(--bd); border-radius: 10px; padding: 10px; background: #fff; }\n    .lbl { display:block; }\n    .lblt { font-size: 11px; color: var(--mut); margin-bottom: 4px; }\n    .inp, .sel, textarea { width: 100%; padding: 8px; border: 1px solid var(--bd); border-radius: 8px; background: #fff; }\n    textarea { min-height: 80px; resize: vertical; }\n    .row { display:flex; gap:8px; align-items:center; }\n    .mut { color: var(--mut); }\n    .chip { background: var(--chip); border:1px solid var(--bd); padding:6px 8px; border-radius: 8px; }\n    .skills { display: grid; grid-template-columns: 1fr auto auto; gap: 6px 8px; align-items: center; }\n    .skillHead { font-size: 12px; color:var(--mut); display: contents; }\n    .btn { border:1px solid var(--bd); background:#fff; padding:8px 10px; border-radius: 8px; cursor:pointer; }\n    .btn:hover { background:#f9fafb; }\n    .btn.small { padding:4px 6px; font-size:12px; }\n    .right { text-align: right; }\n    .status { margin-left: 8px; color: var(--mut); }\n    .attacks .hdr, .attacks .row {\n        display: grid;\n        grid-template-columns: 1.2fr 100px 100px 1fr 1fr max-content; /* Attack | Range | Hit/DC | Damage | Notes | ✕ */\n        gap: 6px;\n        align-items: center;\n    }\n    .attacks .hdr { color: var(--mut); font-size:12px; }\n    .attack-roll-btn { white-space: nowrap; }\n\n    /* Top bar (left: roll/load/save, right: tabs) */\n    .topbar {\n      position: sticky; top: 0; z-index: 10;\n      display: flex; justify-content: space-between; align-items: center;\n      margin-bottom: 8px; padding-top: 8px; background: var(--bg);\n    }\n    .topbar .leftActions, .topbar .rightActions {\n      display: flex; align-items: center; gap: 8px;\n    }\n    .tab.btn {} /* inherits .btn */\n    .tab.btn.active { box-shadow: 0 1px 4px rgba(0,0,0,0.08); }\n\n    /* Right column container (avoid global .right{text-align:right}) */\n    .rightCol { display: flex; flex-direction: column; min-width: 420px; }\n    .rightPanel { display: flex; flex-direction: column; gap: 16px; }\n\n    /* Keep skill prof selects compact and stable */\n    .skills select, .skills .sel {\n      width: 88px !important; min-width: 88px !important; max-width: 88px !important;\n      flex: 0 0 88px; justify-self: start;\n    }\n    .skills { grid-template-columns: 1fr max-content max-content; }\n\n    /* Saving throws compactness */\n    .saving-throws-grid .row { gap: 6px; }\n    .saving-throws-grid .mut { white-space: nowrap; }\n\n    /* Optional: tighten first card header spacing */\n    .left .card:first-child h2, .rightCol .card:first-child h2 { margin-top: 0; }\n  ",e.textContent+="\n  /* Attacks table: header + rows share the same columns */\n  .attacks .header,\n  .attacks .rowGrid {\n    display: grid;\n    grid-template-columns: 1.2fr 100px 100px 1fr 1fr max-content; /* Attack | Range | Hit/DC | Damage | Notes | ✕ */\n    gap: 6px;\n    align-items: center;\n  }\n  .attacks .header {\n    color: var(--mut);\n    font-size: 12px;\n    margin-bottom: 6px;\n  }\n\n  /* Input+button inline for Hit/DC and Damage cells */\n  .attacks .cell-inline { display: flex; align-items: center; gap: 6px; }\n\n  /* Smaller dice buttons */\n  .attack-roll-btn {\n    padding: 2px 6px;\n    font-size: 12px;\n    line-height: 1;\n    border-radius: 6px;\n  }\n",e.textContent+="\n  /* Skills container should NOT be a grid */\n  .skillsTable { display: block; }\n\n  /* Header and each row share the same 3-column grid */\n  .skillsHeader,\n  .skillRow {\n    display: grid;\n    grid-template-columns: 1fr max-content max-content; /* Skill | Total | Prof */\n    gap: 6px 8px;\n    align-items: center;\n  }\n\n  .skillsHeader {\n    color: var(--mut);\n    font-size: 12px;\n    margin-bottom: 6px;\n  }\n\n  .skillRow .right { text-align: right; }\n\n  .skillTotalWrap {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    justify-content: flex-end;\n  }\n\n  /* Keep the small dropdowns compact */\n  .skillsTable select,\n  .skillsTable .sel {\n    width: 88px !important; min-width: 88px !important; max-width: 88px !important;\n    flex: 0 0 88px; justify-self: start;\n  }\n",e.textContent+="\n  /* Spells table mirrors Attacks */\n  .spells .header,\n  .spells .rowGrid {\n    display: grid;\n    grid-template-columns: 1.2fr 100px 100px 1fr 1fr max-content; /* Spell | Range | Hit/DC | Damage | Notes | ✕ */\n    gap: 6px;\n    align-items: center;\n  }\n  .spells .header { color: var(--mut); font-size: 12px; margin-bottom: 6px; }\n\n  /* Inventory table */\n  .inventory .header,\n  .inventory .rowGrid {\n    display: grid;\n    grid-template-columns: 1.2fr 120px 2fr max-content; /* Name | Value | Description | ✕ */\n    gap: 6px;\n    align-items: center;\n  }\n  .inventory .header { color: var(--mut); font-size: 12px; margin-bottom: 6px; }\n",document.head.appendChild(e);var n=w("div",{class:"left"}),r=w("div",{class:"rightCol"}),s=w("div",{class:"card"},[w("h2",{},["Identity"]),E("Name","name",m.name,function(t){return y({name:t})}),w("div",{class:"grid2"},[E("Class","class",m.class,function(t){return y({class:t})}),C("Level","level",m.level,function(t){return y({level:o(t,1,20)})},1,20)]),w("div",{class:"grid3"},[E("Race","race",m.race||"",function(t){return y({race:t})}),E("Background","background",m.background||"",function(t){return y({background:t})}),E("Alignment","alignment",m.alignment||"",function(t){return y({alignment:t})})])]),p=w("div",{class:"card"});p.appendChild(w("h2",{},["Abilities"]));var u=w("div",{class:"grid3"});i.forEach(function(t){var e=C(`${t} (mod ${D(h.mods[t])})`,`abil.${t}`,m.abilities[t],function(e){return k(`abilities.${t}`,o(e,1,30))},1,30);e.setAttribute("data-ability",t),u.appendChild(e)}),p.appendChild(u);var v=w("div",{class:"card"});v.appendChild(w("h2",{},["Saving Throws"]));var f=w("div",{class:"grid3 saving-throws-grid"});i.forEach(function(t){var e=w("div",{class:"row chip"},[w("input",{type:"checkbox",checked:!!m.savingThrowsProficiencies[t]}),w("div",{},[`${t} save`]),w("div",{class:"mut"},[w("span",{id:`save.total.${t}`},[D(h.savingThrows[t])])])]);e.firstChild.addEventListener("change",function(e){var n=e.target.checked;k(`savingThrowsProficiencies.${t}`,n)}),f.appendChild(e)}),v.appendChild(f);var b=w("div",{class:"card"},[w("h2",{},["Combat"]),w("div",{class:"grid3"},[C("Armor Class","ac",m.armorClass,function(t){return y({armorClass:o(t,0,40)})},0,40),C("HP (max)","hp.max",m.maxHP,function(t){return y({maxHP:Math.max(1,t)})},1),C("HP (current)","hp.cur",m.currentHP,function(t){return y({currentHP:o(t,0,m.maxHP)})},0)]),w("div",{class:"grid3",style:{marginTop:"6px"}},[E("Speed","speed",m.speed||"",function(t){return y({speed:t})}),C("Temp HP","hp.temp",m.tempHP||0,function(t){return y({tempHP:Math.max(0,t)})},0),w("label",{class:"lbl"},[w("div",{class:"lblt"},["Initiative"]),w("div",{class:"chip"},[w("span",{id:"derived.initiative"},[D(h.initiative)])," (DEX mod)"])])]),w("div",{class:"row",style:{marginTop:"6px"}},[w("div",{class:"chip"},["Prof bonus: ",w("strong",{id:"derived.pb"},[D(h.proficiencyBonus)])]),w("div",{class:"chip"},["Passive Perception: ",w("strong",{id:"derived.pp"},[String(h.passivePerception)])])])]);n.appendChild(s),n.appendChild(p),n.appendChild(v),n.appendChild(b);var S=w("div",{class:"card"});S.appendChild(w("h2",{},["Skills"]));var H=w("div",{class:"skillsTable"}),P=w("div",{class:"skillsHeader"},[w("div",{},["Skill"]),w("div",{class:"right"},["Total"]),w("div",{},["Prof"])]);H.appendChild(P),l.forEach(function(t){var e=w("div",{},[`${t} `,w("span",{class:"mut"},[`(${a[t]})`])]),n=w("div",{id:`skill.total.${t}`,class:"right"},[D(h.skills[t])]),i=w("button",{class:"btn small",title:"Roll skill"},["🎲"]),l=w("div",{class:"skillTotalWrap"},[n,i]);i.addEventListener("click",function(){var e,n=`1d20${e=h.skills[t],e>=0?"+".concat(e):"".concat(e)}`;if(g)g.postMessage({type:"roll",expr:n});else{var a=d(n);x(`Roll ${t}: ${a.total} (${a.detail})`,4e3)}});var r=function(e){var n=w("select",{class:"sel"},[w("option",{value:"none",selected:"none"===e},["—"]),w("option",{value:"prof",selected:"prof"===e},["●"]),w("option",{value:"expert",selected:"expert"===e},["◎"])]);return n.addEventListener("change",function(){return e=n.value,k(`skillsProficiencies.${t}`,e);var e}),n}(m.skillsProficiencies[t]||"none"),s=w("div",{class:"skillRow"},[e,l,r]);H.appendChild(s)}),S.appendChild(H);var $=w("div",{class:"card attacks"});$.appendChild(w("h2",{},["Attacks"]));var N=w("div",{id:"attacks.list"}),M=w("button",{class:"btn",style:{marginTop:"8px"}},["+ Add attack"]);M.addEventListener("click",function(){m.attacks.push({name:"New Attack",range:"Melee",hitDc:"+0",damage:"1d6+2",notes:""}),h=c(m),T()}),$.appendChild(N),$.appendChild(M);var R,j=w("div",{class:"card"},[w("h2",{},["Notes"]),(R=w("textarea",{value:m.notes||""}),R.addEventListener("input",function(){return y({notes:R.value})}),R)]),O=w("div",{class:"card spells"});O.appendChild(w("h2",{},["Spells"]));var B=w("div",{id:"spells.list"}),z=w("button",{class:"btn",style:{marginTop:"8px"}},["+ Add spell"]);z.addEventListener("click",function(){m.spells.push({name:"New Spell",range:"30 ft",hitDc:"+0",damage:"1d6",notes:""}),h=c(m),I()}),O.appendChild(B),O.appendChild(z);var W=w("div",{class:"card inventory"});W.appendChild(w("h2",{},["Inventory"]));var F=w("div",{id:"inventory.list"}),X=w("button",{class:"btn",style:{marginTop:"8px"}},["+ Add item"]);X.addEventListener("click",function(){m.inventory.push({name:"New Item",value:"",desc:""}),L()}),W.appendChild(F),W.appendChild(X),S.setAttribute("data-panel","skills"),$.setAttribute("data-panel","attacks"),j.setAttribute("data-panel","notes"),O.setAttribute("data-panel","spells"),W.setAttribute("data-panel","inventory");var G=w("div",{class:"rightPanel"});G.appendChild(S),G.appendChild($),G.appendChild(j),G.appendChild(O),G.appendChild(W),r.innerHTML="",r.appendChild(G);var _=w("div",{class:"leftActions"},[w("button",{class:"btn",id:"btn.roll"},["Roll d20"]),w("button",{class:"btn",id:"btn.load"},["Load"]),w("button",{class:"btn",id:"btn.save"},["Save"]),w("div",{id:"status",class:"status"},[""])]),J=w("div",{class:"rightActions"},[w("button",{class:"btn tab active","data-target":"skills"},["Skills"]),w("button",{class:"btn tab","data-target":"attacks"},["Attacks"]),w("button",{class:"btn tab","data-target":"spells"},["Spells"]),w("button",{class:"btn tab","data-target":"inventory"},["Inventory"]),w("button",{class:"btn tab","data-target":"notes"},["Notes"])]),q=w("div",{class:"topbar"},[_,J]);t.innerHTML="";var K=w("div",{class:"wrap"});K.appendChild(q);var V=w("div",{class:"cols"},[n,r]);K.appendChild(V),t.appendChild(K),J.addEventListener("click",function(t){var e=t.target.closest(".tab");e&&U(e.getAttribute("data-target"))}),U("skills"),document.getElementById("btn.roll").addEventListener("click",function(){if(g)g.postMessage({type:"roll",expr:"1d20"});else{var t=d("1d20");x(`Roll d20: ${t.total} (${t.detail})`,3e3)}}),document.getElementById("btn.save").addEventListener("click",function(){g?g.postMessage({type:"save",character:m}):(function(t){try{localStorage.setItem("dnd.character.editor.v1",JSON.stringify(t))}catch(t){}}(m),x("Saved locally ✓"))}),document.getElementById("btn.load").addEventListener("click",function(){g?(g.postMessage({type:"load"}),x("Loading…")):x("Nothing to load (offline)")}),T(),I(),L(),A()}function U(t){Array.from(J.querySelectorAll(".tab")).forEach(e=>e.classList.toggle("active",e.getAttribute("data-target")===t)),Array.from(G.children).forEach(e=>e.style.display=e.getAttribute("data-panel")===t?"":"none")}}function I(){var t=document.getElementById("spells.list");t&&(t.innerHTML="",m.spells.forEach(function(e,n){var a=null!=e.hitDc?String(e.hitDc):"+0",i=null!=e.damage?String(e.damage):"1d6",l=null!=e.range?String(e.range):"",r=w("input",{class:"inp",value:e.name||""}),s=w("input",{class:"inp",value:l}),o=w("input",{class:"inp",value:a,title:"Enter modifier (e.g. +5). Double-click/Enter or 🎲 to roll"}),c=w("button",{class:"btn attack-roll-btn",title:"Roll Hit/DC"},["🎲"]),u=w("div",{class:"cell-inline"},[o,c]),v=w("input",{class:"inp",value:i,title:"Composite damage like 2d6+1d4+3"}),f=w("button",{class:"btn attack-roll-btn",title:"Roll Damage"},["🎲"]),h=w("div",{class:"cell-inline"},[v,f]),b=w("input",{class:"inp",value:e.notes||""}),y=w("button",{class:"btn small",title:"Remove"},["✕"]);function k(){var t=parseInt(String(o.value).replace(/\s+/g,""),10);Number.isFinite(t)||(t=0);var n=`1d20${t>=0?"+"+t:t}`;if(g)g.postMessage({type:"roll",expr:n});else{var a=d(n);x(`Spell Hit/DC (${e.name||"Spell"}): ${a.total} (${a.detail})`,4e3)}}function E(){var t=p(String(v.value||"0"));g&&t.exprForHost?g.postMessage({type:"roll",expr:t.exprForHost}):x(`Spell Damage (${e.name||"Spell"}): ${t.total} (${t.detail})`,4e3)}r.addEventListener("input",function(){m.spells[n].name=r.value}),s.addEventListener("input",function(){m.spells[n].range=s.value}),o.addEventListener("input",function(){m.spells[n].hitDc=o.value}),v.addEventListener("input",function(){m.spells[n].damage=v.value}),b.addEventListener("input",function(){m.spells[n].notes=b.value}),y.addEventListener("click",function(){m.spells.splice(n,1),I()}),c.addEventListener("click",k),f.addEventListener("click",E),o.addEventListener("keydown",function(t){"Enter"===t.key&&k()}),o.addEventListener("dblclick",k),v.addEventListener("keydown",function(t){"Enter"===t.key&&E()}),v.addEventListener("dblclick",E);var C=w("div",{class:"rowGrid"},[H("Spell",r),H("Range",s),H("Hit/DC",u),H("Damage",h),H("Notes",b),y]);t.appendChild(C)}))}function L(){var t=document.getElementById("inventory.list");t&&(t.innerHTML="",m.inventory.forEach(function(e,n){var a=w("input",{class:"inp",value:e.name||""}),i=w("input",{class:"inp",value:e.value||"",placeholder:"e.g., 25 gp"}),l=w("input",{class:"inp",value:e.desc||""}),r=w("button",{class:"btn small",title:"Remove"},["✕"]);a.addEventListener("input",function(){m.inventory[n].name=a.value}),i.addEventListener("input",function(){m.inventory[n].value=i.value}),l.addEventListener("input",function(){m.inventory[n].desc=l.value}),r.addEventListener("click",function(){m.inventory.splice(n,1),L()});var s=w("div",{class:"rowGrid"},[H("Item",a),H("Value",i),H("Description",l),r]);t.appendChild(s)}))}function H(t,e){return w("label",{class:"lbl"},[w("div",{class:"lblt"},[t]),e])}function T(){var t=document.getElementById("attacks.list");t&&(t.innerHTML="",m.attacks.forEach(function(e,n){var a=null!=e.hitDc?String(e.hitDc):null!=e.toHit?String(e.toHit):"+0",i=null!=e.damage?String(e.damage):"1d4",l=null!=e.range?String(e.range):"",r=w("input",{class:"inp",value:e.name||""}),s=w("input",{class:"inp",value:l}),o=w("input",{class:"inp",value:a,title:"Enter modifier (e.g. +5). Double-click/Enter or 🎲 to roll"}),c=w("button",{class:"btn attack-roll-btn",title:"Roll Hit/DC"},["🎲"]),u=w("div",{class:"cell-inline"},[o,c]),v=w("input",{class:"inp",value:i,title:"Composite damage like 2d6+1d4+3"}),f=w("button",{class:"btn attack-roll-btn",title:"Roll Damage"},["🎲"]),h=w("div",{class:"cell-inline"},[v,f]),b=w("input",{class:"inp",value:e.notes||""}),y=w("button",{class:"btn small",title:"Remove"},["✕"]);function k(){var t=parseInt(String(o.value).replace(/\s+/g,""),10);Number.isFinite(t)||(t=0);var n=`1d20${t>=0?"+"+t:t}`;if(g)g.postMessage({type:"roll",expr:n});else{var a=d(n);x(`Hit/DC (${e.name||"Attack"}): ${a.total} (${a.detail})`,4e3)}}function E(){var t=p(String(v.value||"0"));g&&t.exprForHost?g.postMessage({type:"roll",expr:t.exprForHost}):x(`Damage (${e.name||"Attack"}): ${t.total} (${t.detail})`,4e3)}r.addEventListener("input",function(){m.attacks[n].name=r.value}),s.addEventListener("input",function(){m.attacks[n].range=s.value}),o.addEventListener("input",function(){m.attacks[n].hitDc=o.value,m.attacks[n].toHit=o.value}),v.addEventListener("input",function(){m.attacks[n].damage=v.value}),b.addEventListener("input",function(){m.attacks[n].notes=b.value}),y.addEventListener("click",function(){m.attacks.splice(n,1),T()}),c.addEventListener("click",k),f.addEventListener("click",E),o.addEventListener("keydown",function(t){"Enter"===t.key&&k()}),o.addEventListener("dblclick",k),v.addEventListener("keydown",function(t){"Enter"===t.key&&E()}),v.addEventListener("dblclick",E);var C=w("div",{class:"rowGrid"},[H("Attack",r),H("Range",s),H("Hit/DC",u),H("Damage",h),H("Notes",b),y]);t.appendChild(C)}))}function A(){i.forEach(function(t){var e=document.querySelector('[data-ability="'.concat(t,'"] .lblt'));e&&(e.textContent="".concat(t," (mod ").concat(D(h.mods[t]),")"))});var t=document.getElementById("derived.pb");t&&(t.textContent=D(h.proficiencyBonus));var e=document.getElementById("derived.pp");e&&(e.textContent=String(h.passivePerception));var n=document.getElementById("derived.initiative");n&&(n.textContent=D(h.initiative)),i.forEach(function(t){var e=document.getElementById("save.total.".concat(t));e&&(e.textContent=D(h.savingThrows[t]))}),l.forEach(function(t){var e=document.getElementById("skill.total.".concat(t));e&&(e.textContent=D(h.skills[t]))})}function D(t){return t>=0?"+".concat(t):"".concat(t)}function P(t,e){const n={STR:null!==(i=null==(a={...t.abilities,...e.abilities??{}})?void 0:a.STR)&&void 0!==i?i:10,DEX:null!==(r=null==a?void 0:a.DEX)&&void 0!==r?r:10,CON:null!==(s=null==a?void 0:a.CON)&&void 0!==s?s:10,INT:null!==(o=null==a?void 0:a.INT)&&void 0!==o?o:10,WIS:null!==(c=null==a?void 0:a.WIS)&&void 0!==c?c:10,CHA:null!==(d=null==a?void 0:a.CHA)&&void 0!==d?d:10};var a,i,r,s,o,c,d;const p=function(t){for(var e,n={},a=0,i=l;a<i.length;a++){var r=i[a];n[r]=null!==(e=null==t?void 0:t[r])&&void 0!==e?e:"none"}return n}({...t.skillsProficiencies??{},...e.skillsProficiencies??{}});return{...t,...e,abilities:n,savingThrowsProficiencies:{...t.savingThrowsProficiencies||{},...e.savingThrowsProficiencies||{}},skillsProficiencies:p,attacks:(e.attacks||t.attacks||[]).map(t=>({name:"",toHit:"",damage:"",notes:"",...t})),spells:(e.spells||t.spells||[]).map(t=>({name:"New Spell",range:"",hitDc:"+0",damage:"1d6",notes:"",...t})),inventory:(e.inventory||t.inventory||[]).map(t=>({name:"New Item",value:"",desc:"",...t}))}}!function(){function t(){try{!function(){e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return document.getElementById("root")||((t=document.createElement("div")).id="root",document.body.appendChild(t)),S(),[4,s(1500)];case 1:if(g=e.sent())g.onMessage(function(t){const e=t&&"object"==typeof t?"message"in t&&"object"==typeof t.message?t.message:"data"in t&&"object"==typeof t.data?t.data:t:t;console.log("[webview] message (unwrapped):",e," raw:",t),e&&"object"==typeof e&&("data"===e.type?(v=e.noteId||v,m=P(u(),e.character||{}),h=c(m),v&&function(t,e){if(t)try{localStorage.setItem(f(t),JSON.stringify(e))}catch{}}(v,m),S(),x("Loaded ✓")):"saved"===e.type?x("Saved ✓"):"error"===e.type?x(`Error: ${e.message}`,4e3):"rollResult"===e.type&&x(`Roll: ${e.result}`,4e3))}),g.postMessage({type:"load"});else{const t=v?function(t){if(!t)return null;try{const e=localStorage.getItem(f(t));return e?JSON.parse(e):null}catch{return null}}(v):null;t?(m=P(u(),t),h=c(m),S(),x("Loaded (local cache)")):x("Offline mode — using defaults")}return[2]}})})}();const t=r();t&&(g=t).postMessage({type:"ready"})}catch(t){console.error("[renderer] bootstrap error:",t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}()}})[647](),exports.default={}.default;