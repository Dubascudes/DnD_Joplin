({647:function(){var t=this&&this.__assign||function(){return t=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)},e=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(i,r){function o(t){try{l(a.next(t))}catch(t){r(t)}}function s(t){try{l(a.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,s)}l((a=a.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var n,a,i,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(r=0)),r;)try{if(n=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t],a=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},a={Acrobatics:"DEX","Animal Handling":"WIS",Arcana:"INT",Athletics:"STR",Deception:"CHA",History:"INT",Insight:"WIS",Intimidation:"CHA",Investigation:"INT",Medicine:"WIS",Nature:"INT",Perception:"WIS",Performance:"CHA",Persuasion:"CHA",Religion:"INT","Sleight of Hand":"DEX",Stealth:"DEX",Survival:"WIS"},i=["STR","DEX","CON","INT","WIS","CHA"],r=Object.keys(a);function o(){var t;try{var e=null!==(t=globalThis.webviewApi)&&void 0!==t?t:window.webviewApi;if(e&&"function"==typeof e.postMessage&&"function"==typeof e.onMessage)return e}catch(t){}return null}function s(){return e(this,arguments,void 0,function(t){var e,a;return void 0===t&&(t=1200),n(this,function(n){switch(n.label){case 0:e=Date.now(),n.label=1;case 1:return(a=o())?[2,a]:Date.now()-e>t?[2,null]:[4,new Promise(function(t){return setTimeout(t,50)})];case 2:n.sent(),n.label=3;case 3:return[3,1];case 4:return[2]}})})}var l=function(t,e,n){return Math.max(e,Math.min(n,t))};function c(t){var e,n=i.reduce(function(e,n){return e[n]=(a=t.abilities[n],Math.floor((a-10)/2)),e;var a},{}),o=(e=t.level||1)>=17?6:e>=13?5:e>=9?4:e>=5?3:2,s=i.reduce(function(e,a){var i,r=n[a],s=(null===(i=t.savingThrowsProficiencies)||void 0===i?void 0:i[a])?o:0;return e[a]=r+s,e},{}),l=r.reduce(function(e,i){var r,s=n[a[i]],l=(null===(r=t.skillsProficiencies)||void 0===r?void 0:r[i])||"none",c="prof"===l?o:"expert"===l?2*o:0;return e[i]=s+c,e},{}),c=10+l.Perception,d=n.DEX;return{mods:n,proficiencyBonus:o,skills:l,savingThrows:s,passivePerception:c,initiative:d}}function d(t){if(t=t.trim(),/^\s*([+\-]?\d+)\s*$/.test(t)){var e=parseInt(t,10);return{total:e,detail:"".concat(e)}}var n=/^\s*(?:(-?\d*)\s*)?d\s*(\d+)\s*([+\-]\s*\d+)?\s*$/i.exec(t);if(!n)return{total:NaN,detail:"Invalid roll"};for(var a=n[1],i=n[2],r=n[3],o=a?parseInt(a,10):1,s=parseInt(i,10),l=r?parseInt(r.replace(/\s+/g,""),10):0,c=Math.max(1,Math.abs(o)),d=[],u=0;u<c;u++)d.push(1+Math.floor(Math.random()*s));var p=d.reduce(function(t,e){return t+e},0),v=(p=o<0?-p:p)+l,f=l>=0?"+".concat(l):"".concat(l);return{total:v,detail:"".concat(o,"d").concat(s).concat(l?f:""," = [").concat(d.join(", "),"] ").concat(o<0?"=> negate ":"").concat(p).concat(l?" ".concat(f," = ").concat(v):"")}}function u(){return{name:"",class:"",level:1,race:"",background:"",alignment:"",abilities:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},armorClass:10,maxHP:1,currentHP:1,tempHP:0,speed:"30 ft",savingThrowsProficiencies:{},skillsProficiencies:r.reduce(function(t,e){return t[e]="none",t},{}),attacks:[],notes:""}}var p=null;function v(t){return"dnd.character.editor.v1:"+(t||"unknown")}var f=null,g=u(),h=c(g),m=null;function b(t,e){void 0===e&&(e=1600);var n=document.getElementById("status");n&&(n.textContent=t),m&&window.clearTimeout(m),m=window.setTimeout(function(){n&&n.textContent===t&&(n.textContent="")},e)}function x(e){g=t(t({},g),e),h=c(g),I()}function y(t,e){for(var n,a=t.split("."),i=a.pop(),r=g,o=0,s=a;o<s.length;o++){var l=s[o];r[l]=null!==(n=r[l])&&void 0!==n?n:{},r=r[l]}r[i]=e,h=c(g),I()}function k(t,e,n){void 0===e&&(e={}),void 0===n&&(n=[]);for(var a=document.createElement(t),i=0,r=Object.entries(e);i<r.length;i++){var o=r[i],s=o[0],l=o[1];"class"===s?a.className=l:"style"===s&&"object"==typeof l?Object.assign(a.style,l):s.startsWith("data-")?a.setAttribute(s,String(l)):"for"===s?a.setAttribute("for",String(l)):"value"===s?a.value=l:s in a?a[s]=l:a.setAttribute(s,String(l))}for(var c=0,d=n;c<d.length;c++){var u=d[c];a.appendChild("string"==typeof u?document.createTextNode(u):u)}return a}function w(t,e,n,a,i){void 0===i&&(i="text");var r=k("input",{id:e,type:i,value:n,class:"inp"});return r.addEventListener("input",function(){return a(r.value)}),k("label",{class:"lbl"},[k("div",{class:"lblt"},[t]),r])}function C(t,e,n,a,i,r){var o=k("input",{id:e,type:"number",value:n,class:"inp"});return void 0!==i&&o.setAttribute("min",String(i)),void 0!==r&&o.setAttribute("max",String(r)),o.addEventListener("input",function(){return a(function(t,e){void 0===e&&(e=0);var n=parseInt(String(t),10);return Number.isFinite(n)?n:e}(o.value,n))}),k("label",{class:"lbl"},[k("div",{class:"lblt"},[t]),o])}function E(){var t=document.getElementById("root");if(t){var e=document.createElement("style");e.textContent="\n    :root { --bd:#d0d4db; --tx:#101216; --mut:#5a6270; --bg:#ffffff; --chip:#f5f7fa; }\n    * { box-sizing: border-box; }\n    body { margin:0; background: var(--bg); color: var(--tx); font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }\n    .wrap { padding: 12px; }\n    h2 { margin: 16px 0 8px; font-size: 16px; }\n    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }\n    .grid3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }\n    .cols { display: grid; grid-template-columns: 320px 1fr; gap: 16px; align-items: start; }\n    .card { border: 1px solid var(--bd); border-radius: 10px; padding: 10px; background: #fff; }\n    .lbl { display:block; }\n    .lblt { font-size: 11px; color: var(--mut); margin-bottom: 4px; }\n    .inp, .sel, textarea { width: 100%; padding: 8px; border: 1px solid var(--bd); border-radius: 8px; background: #fff; }\n    textarea { min-height: 80px; resize: vertical; }\n    .row { display:flex; gap:8px; align-items:center; }\n    .mut { color: var(--mut); }\n    .chip { background: var(--chip); border:1px solid var(--bd); padding:6px 8px; border-radius: 8px; }\n    .skills { display: grid; grid-template-columns: 1fr auto auto; gap: 6px 8px; align-items: center; }\n    .skillHead { font-size: 12px; color:var(--mut); display: contents; }\n    .btn { border:1px solid var(--bd); background:#fff; padding:8px 10px; border-radius: 8px; cursor:pointer; }\n    .btn:hover { background:#f9fafb; }\n    .btn.small { padding:4px 6px; font-size:12px; }\n    .right { text-align: right; }\n    .status { margin-left: 8px; color: var(--mut); }\n    .attacks .hdr, .attacks .row { display:grid; grid-template-columns: 1fr 120px 1fr 28px; gap: 6px; align-items:center; }\n    .attacks .hdr { color: var(--mut); font-size:12px; }\n  ",e.textContent+="\n    /* Keep skill prof selects compact */\n    .skills select,\n    .skills .sel {\n        width: 88px !important;\n        min-width: 88px !important;\n        max-width: 88px !important;\n        flex: 0 0 88px;\n        justify-self: start; /* prevents right-justifying in the grid cell */\n    }\n    /* Make the Skills grid columns stable */\n    .skills {\n        grid-template-columns: 1fr max-content max-content; /* name | total | prof */\n    }\n    ",e.textContent+="\n  /* Save rows: compact the label + checkbox + total */\n  .saving-throws-grid .row { gap: 6px; }\n  .saving-throws-grid .mut { white-space: nowrap; }\n",e.textContent+="\n  /* Top bar with left actions (Roll/Load/Save) and right tabs */\n  .topbar {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 8px;\n  }\n  .topbar .leftActions,\n  .topbar .rightActions {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n\n  /* Tabs look exactly like .btn, active gets a subtle lift */\n  .tab.btn { /* already inherits .btn styles */ }\n  .tab.btn.active {\n    box-shadow: 0 1px 4px rgba(0,0,0,0.08);\n  }\n\n  /* Right column container (new class so we don't inherit global .right text-align) */\n  .rightCol { display: flex; flex-direction: column; min-width: 420px; }\n\n  /* The panel that holds whichever card is visible */\n  .rightPanel { display: flex; flex-direction: column; gap: 16px; }\n\n  /* Keep skill prof selects compact (from before) */\n  .skills select, .skills .sel {\n    width: 88px !important; min-width: 88px !important; max-width: 88px !important;\n    flex: 0 0 88px; justify-self: start;\n  }\n  .skills { grid-template-columns: 1fr max-content max-content; }\n\n  /* Saving throws compactness (from before) */\n  .saving-throws-grid .row { gap: 6px; }\n  .saving-throws-grid .mut { white-space: nowrap; }\n\n  /* Optional: remove extra top space inside the very first cards */\n  .left .card:first-child h2, .rightCol .card:first-child h2 { margin-top: 0; }\n",document.head.appendChild(e);var n=k("div",{class:"left"}),o=k("div",{class:"rightCol"}),s=k("div",{class:"card"},[k("h2",{},["Identity"]),w("Name","name",g.name,function(t){return x({name:t})}),k("div",{class:"grid2"},[w("Class","class",g.class,function(t){return x({class:t})}),C("Level","level",g.level,function(t){return x({level:l(t,1,20)})},1,20)]),k("div",{class:"grid3"},[w("Race","race",g.race||"",function(t){return x({race:t})}),w("Background","background",g.background||"",function(t){return x({background:t})}),w("Alignment","alignment",g.alignment||"",function(t){return x({alignment:t})})])]),u=k("div",{class:"card"});u.appendChild(k("h2",{},["Abilities"]));var p=k("div",{class:"grid3"});i.forEach(function(t){var e=C("".concat(t," (mod ").concat(T(h.mods[t]),")"),"abil.".concat(t),g.abilities[t],function(e){return y("abilities.".concat(t),l(e,1,30))},1,30);e.setAttribute("data-ability",t),p.appendChild(e)}),u.appendChild(p);var v=k("div",{class:"card"});v.appendChild(k("h2",{},["Saving Throws"]));var m=k("div",{class:"grid3 saving-throws-grid"});i.forEach(function(t){var e=k("div",{class:"row chip"},[k("input",{type:"checkbox",checked:!!g.savingThrowsProficiencies[t]}),k("div",{},["".concat(t," save")]),k("div",{class:"mut"},[k("span",{id:"save.total.".concat(t)},[T(h.savingThrows[t])])])]);e.firstChild.addEventListener("change",function(e){var n=e.target.checked;y("savingThrowsProficiencies.".concat(t),n)}),m.appendChild(e)}),v.appendChild(m);var E=k("div",{class:"card"},[k("h2",{},["Combat"]),k("div",{class:"grid3"},[C("Armor Class","ac",g.armorClass,function(t){return x({armorClass:l(t,0,40)})},0,40),C("HP (max)","hp.max",g.maxHP,function(t){return x({maxHP:Math.max(1,t)})},1),C("HP (current)","hp.cur",g.currentHP,function(t){return x({currentHP:l(t,0,g.maxHP)})},0)]),k("div",{class:"grid3",style:{marginTop:"6px"}},[w("Speed","speed",g.speed||"",function(t){return x({speed:t})}),C("Temp HP","hp.temp",g.tempHP||0,function(t){return x({tempHP:Math.max(0,t)})},0),k("label",{class:"lbl"},[k("div",{class:"lblt"},["Initiative"]),k("div",{class:"chip"},[k("span",{id:"derived.initiative"},[T(h.initiative)])," (DEX mod)"])])]),k("div",{class:"row",style:{marginTop:"6px"}},[k("div",{class:"chip"},["Prof bonus: ",k("strong",{id:"derived.pb"},[T(h.proficiencyBonus)])]),k("div",{class:"chip"},["Passive Perception: ",k("strong",{id:"derived.pp"},[String(h.passivePerception)])])])]);n.appendChild(s),n.appendChild(u),n.appendChild(v),n.appendChild(E);var A=k("div",{class:"card"});A.appendChild(k("h2",{},["Skills"]));var H=k("div",{class:"skills"});H.appendChild(k("div",{class:"skillHead"},["Skill"])),H.appendChild(k("div",{class:"skillHead right"},["Total"])),H.appendChild(k("div",{class:"skillHead"},["Prof"])),r.forEach(function(t){var e=a[t];H.appendChild(k("div",{},["".concat(t," "),k("span",{class:"mut"},["(".concat(e,")")])]));var n=k("div",{id:"skill.total.".concat(t),class:"right"},[T(h.skills[t])]),i=k("button",{class:"btn small",title:"Roll skill"},["🎲"]),r=k("div",{class:"row",style:{justifyContent:"flex-end"}},[n,i]);H.appendChild(r),i.addEventListener("click",function(){if(f)f.postMessage({type:"roll",expr:"1d20".concat(P(h.skills[t]))});else{var e=d("1d20".concat(P(h.skills[t])));b("Roll ".concat(t,": ").concat(e.total," (").concat(e.detail,")"),4e3)}});var o=function(e){var n=k("select",{class:"sel"},[k("option",{value:"none",selected:"none"===e},["—"]),k("option",{value:"prof",selected:"prof"===e},["●"]),k("option",{value:"expert",selected:"expert"===e},["◎"])]);return n.addEventListener("change",function(){return e=n.value,y("skillsProficiencies.".concat(t),e);var e}),n}(g.skillsProficiencies[t]||"none");H.appendChild(o)}),A.appendChild(H);var N=k("div",{class:"card attacks"});N.appendChild(k("h2",{},["Attacks"]));var L=k("div",{class:"hdr"},["Name","To Hit","Damage",""]),M=k("div",{id:"attacks.list"}),j=k("button",{class:"btn",style:{marginTop:"8px"}},["+ Add attack"]);j.addEventListener("click",function(){g.attacks.push({name:"New Attack",toHit:"+0",damage:"1d4",notes:""}),h=c(g),S()}),N.appendChild(L),N.appendChild(M),N.appendChild(j);var O,B=k("div",{class:"card"},[k("h2",{},["Notes"]),(O=k("textarea",{value:g.notes||""}),O.addEventListener("input",function(){return x({notes:O.value})}),O)]);A.setAttribute("data-panel","skills"),N.setAttribute("data-panel","attacks"),B.setAttribute("data-panel","notes");var R=k("div",{class:"rightTabs"},[k("button",{class:"btn tab active","data-target":"skills"},["Skills"]),k("button",{class:"btn tab","data-target":"attacks"},["Attacks"]),k("button",{class:"btn tab","data-target":"notes"},["Notes"])]),D=k("div",{class:"rightPanel"});D.appendChild(A),D.appendChild(N),D.appendChild(B),R.addEventListener("click",t=>{var e=t.target.closest(".tab");e&&_(e.getAttribute("data-target"))}),o.innerHTML="",o.appendChild(R),o.appendChild(D),_("skills");var W=k("div",{class:"row",style:{marginBottom:"8px"}},[k("button",{class:"btn",id:"btn.roll"},["Roll d20"]),k("button",{class:"btn",id:"btn.load"},["Load"]),k("button",{class:"btn",id:"btn.save"},["Save"]),k("div",{id:"status",class:"status"},[""])]);t.innerHTML="";var X=k("div",{class:"wrap"});X.appendChild(W);var z=k("div",{class:"cols"},[n,o]);X.appendChild(z),t.appendChild(X),document.getElementById("btn.roll").addEventListener("click",function(){if(f)f.postMessage({type:"roll",expr:"1d20"});else{var t=d("1d20");b("Roll d20: ".concat(t.total," (").concat(t.detail,")"),3e3)}}),document.getElementById("btn.save").addEventListener("click",function(){f?f.postMessage({type:"save",character:g}):(function(t){try{localStorage.setItem("dnd.character.editor.v1",JSON.stringify(t))}catch(t){}}(g),b("Saved locally ✓"))}),document.getElementById("btn.load").addEventListener("click",function(){f?(f.postMessage({type:"load"}),b("Loading…")):b("Nothing to load (offline)")}),S(),I()}function _(t){Array.from(R.querySelectorAll(".tab")).forEach(e=>e.classList.toggle("active",e.getAttribute("data-target")===t)),Array.from(D.children).forEach(e=>e.style.display=e.getAttribute("data-panel")===t?"":"none")}}function S(){var t=document.getElementById("attacks.list");t&&(t.innerHTML="",g.attacks.forEach(function(e,n){k("div",{class:"row"}),k("div",{class:"row",style:{width:"100%"}},[]);var a=k("input",{class:"inp",value:e.name}),i=k("input",{class:"inp",value:e.toHit}),r=k("input",{class:"inp",value:e.damage}),o=k("button",{class:"btn small",title:"Remove"},["✕"]);a.addEventListener("input",function(){g.attacks[n].name=a.value}),i.addEventListener("input",function(){g.attacks[n].toHit=i.value}),r.addEventListener("input",function(){g.attacks[n].damage=r.value}),o.addEventListener("click",function(){g.attacks.splice(n,1),S()});var s=k("div",{class:"hdr"},[a,i,r,o]);t.appendChild(s)}))}function I(){i.forEach(function(t){var e=document.querySelector('[data-ability="'.concat(t,'"] .lblt'));e&&(e.textContent="".concat(t," (mod ").concat(T(h.mods[t]),")"))});var t=document.getElementById("derived.pb");t&&(t.textContent=T(h.proficiencyBonus));var e=document.getElementById("derived.pp");e&&(e.textContent=String(h.passivePerception));var n=document.getElementById("derived.initiative");n&&(n.textContent=T(h.initiative)),i.forEach(function(t){var e=document.getElementById("save.total.".concat(t));e&&(e.textContent=T(h.savingThrows[t]))}),r.forEach(function(t){var e=document.getElementById("skill.total.".concat(t));e&&(e.textContent=T(h.skills[t]))})}function T(t){return t>=0?"+".concat(t):"".concat(t)}function P(t){return t>=0?"+".concat(t):"".concat(t)}function A(e,n){var a,i,o,s=function(t){var e,n,a,i,r,o;return{STR:null!==(e=null==t?void 0:t.STR)&&void 0!==e?e:10,DEX:null!==(n=null==t?void 0:t.DEX)&&void 0!==n?n:10,CON:null!==(a=null==t?void 0:t.CON)&&void 0!==a?a:10,INT:null!==(i=null==t?void 0:t.INT)&&void 0!==i?i:10,WIS:null!==(r=null==t?void 0:t.WIS)&&void 0!==r?r:10,CHA:null!==(o=null==t?void 0:t.CHA)&&void 0!==o?o:10}}(t(t({},e.abilities),null!==(a=n.abilities)&&void 0!==a?a:{})),l=function(t){for(var e,n={},a=0,i=r;a<i.length;a++){var o=i[a];n[o]=null!==(e=null==t?void 0:t[o])&&void 0!==e?e:"none"}return n}(t(t({},null!==(i=e.skillsProficiencies)&&void 0!==i?i:{}),null!==(o=n.skillsProficiencies)&&void 0!==o?o:{}));return t(t(t({},e),n),{abilities:s,savingThrowsProficiencies:t(t({},e.savingThrowsProficiencies||{}),n.savingThrowsProficiencies||{}),skillsProficiencies:l,attacks:(n.attacks||e.attacks||[]).map(function(e){return t({name:"",toHit:"",damage:"",notes:""},e)})})}!function(){function t(){try{!function(){e(this,void 0,void 0,function(){var t;return n(this,function(e){switch(e.label){case 0:return document.getElementById("root")||((t=document.createElement("div")).id="root",document.body.appendChild(t)),E(),[4,s(1500)];case 1:if(f=e.sent())f.onMessage(function(t){const e=t&&"object"==typeof t?"message"in t&&"object"==typeof t.message?t.message:"data"in t&&"object"==typeof t.data?t.data:t:t;console.log("[webview] message (unwrapped):",e," raw:",t),e&&"object"==typeof e&&("data"===e.type?(p=e.noteId||p,g=A(u(),e.character||{}),h=c(g),p&&function(t,e){if(t)try{localStorage.setItem(v(t),JSON.stringify(e))}catch{}}(p,g),E(),b("Loaded ✓")):"saved"===e.type?b("Saved ✓"):"error"===e.type?b(`Error: ${e.message}`,4e3):"rollResult"===e.type&&b(`Roll: ${e.result}`,4e3))}),f.postMessage({type:"load"});else{const t=p?function(t){if(!t)return null;try{const e=localStorage.getItem(v(t));return e?JSON.parse(e):null}catch{return null}}(p):null;t?(g=A(u(),t),h=c(g),E(),b("Loaded (local cache)")):b("Offline mode — using defaults")}return[2]}})})}();const t=o();t&&(f=t).postMessage({type:"ready"})}catch(t){console.error("[renderer] bootstrap error:",t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}()}})[647](),exports.default={}.default;